import{af as j,ag as Se,d as Ve,a as he,j as h,s as N,k as Ie,r as _,o as b,b as oe,w as r,p as l,h as D,l as s,t as ve,g as v,i as Y,E as x,D as ae,G as ie,e as I,F as Q,f as ne,a1 as se,a0 as Te,$ as X,q as Z,v as ge,C as Ue,B as Be,c as Ae,ah as le,ai as Ee,aj as Le}from"./.store-BiC8x167.js";import{J as je}from"./_jsencrypt@3.3.2@jsencrypt-D3I3x59l.js";import{_ as ce}from"./index-9lyiukMw.js";function De(e){if(typeof e=="string")try{let o=JSON.parse(e);return!!(typeof o=="object"&&o)}catch{return!1}else return!1}const Oe=`赠汪伦
   唐·李白
   lǐ bái chéng zhōu jiāng yù xíng   hū wén àn shàng tà gē shēng   
   李  白  乘  舟  将  欲  行  ，  忽  闻  岸  上  踏  歌  声  。
  táo huā tán shuǐ shēn qiān chǐ   bù jí wāng lún sòng wǒ qíng   
   桃  花  潭  水  深  千  尺  ，  不  及  汪  伦  送  我  情  。  `;function Ne(e){var o=j.AES.encrypt(JSON.stringify(e),Oe);return o.toString()}function _e(e){if(e){Object.prototype.toString.call(e)=="[object Object]",Object.prototype.toString.call(e)=="[object Array]",Object.prototype.toString.call(e)=="[object String]"&&(e=De(e)?JSON.parse(params):{});let o=Pe(16),a=new je;a.setPublicKey(`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2dLfY5WC5+Vy1kJmDKFT
EOxAXqhai4FfuFIvHwbbyPmO1oAH2Ud5atv5Jgako4SIIO/HlqifP3rhAeQ8XgBT
rZ6zTlD/wmweyQ+i3xrApOfu6TH3Cx/Sbt8UvaEey2jJBodyWYqZd7nUGLije3m2
lRWBIq1XUaXMZMm6wXDPxpYZ15G4lD67kiXagOvf1FtuA3xYoDHPaaNROmiv+qeV
GpDCsTs1pQpZenOMhdbK7AH9zwQq2RyUywAtag7McLJFWmZtkGqUZu4Yfiur0QpI
gY+vkg9XJdoUVRsYb8miM42qMCcFoWJtrT3URaeqGdULbb3I2BLtVxg0qDtxs3Qt
dwIDAQAB
-----END PUBLIC KEY-----`);let n=a.encrypt(o),u="";for(let g in e)u+=e[g];let c=j.MD5(u).toString().toUpperCase(),S=$e(o,{...e,sign:c});return{sk:n,data:S}}return e}function Pe(e=0){let o=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a="";for(let n=0;n<e;n++)a+=o[Math.floor(Math.random()*o.length)];return a}function $e(e,o){let a=j.enc.Utf8.parse(e),n=j.enc.Utf8.parse(JSON.stringify(o));return j.AES.encrypt(n,a,{iv:j.enc.Utf8.parse("0010010000100100"),mode:j.mode.CBC,padding:j.pad.Pkcs7}).ciphertext.toString()}const J=Se.create({baseURL:"http://1.94.146.141:8848",timeout:1e4});function ye(e,o){return new Promise((a,n)=>{J.get(e,{params:o},{credentials:"include"}).then(u=>{a(u.data)}).catch(u=>{n(u)})})}function re(e,o){return new Promise((a,n)=>{const u={header:{"Content-Type":"application/json"}};J.post(e,o,u).then(c=>{a(c.data)}).catch(c=>{n(c)})})}function qe(e,o){return new Promise((a,n)=>{const u={header:{"Content-Type":"application/json"}};J.delete(e,{params:o},u).then(c=>{a(c.data)}).catch(c=>{n(c)})})}function Me(e,o){return new Promise((a,n)=>{const u={headers:{"Content-Type":"multipart/form-data"}};J.post(e,o,u).then(c=>{a(c.data)}).catch(c=>{n(c)})})}J.interceptors.request.use(function(e){if(console.log("请求数据",e.params,e.data),["get","delete"].includes(e.method)){let o=_e(e.params);e.params=o}else{let o=_e(e.data);e.data=o}return e},function(e){return Promise.reject(e)});J.interceptors.response.use(function(e){return console.log("响应数据",e),e},function(e){return Promise.reject(e)});const Je=e=>ye("ws/getTitleList",e),me=e=>ye("ws/getRecordList",e),Re=e=>re("ws/createTopic",e),Ke=e=>re("ws/updateTopic",e),ze=e=>qe("ws/deleteTopic",e),Fe=e=>re("ws/selectVersion",e),He=e=>Me("users/login",e),ue=Ve("userStore",{state:()=>({userInfo:{id:5,name:"张三",chatModel:"4.0Ultra"}}),actions:{loginAction(e){return new Promise((o,a)=>{He(e).then(n=>{n.code===200&&(this.userInfo=n.userInfo),o(n)}).catch(n=>{a(n)})})}},getters:{},persist:{enabled:!0,strategies:[{storage:localStorage}]}}),Qe=e=>(ae("data-v-8ce87bfa"),e=e(),ie(),e),Ye={class:"login_register"},Ge={class:"login_register_form"},We=Qe(()=>s("div",{class:"operation_btn"},null,-1)),Xe=he({name:"Login",__name:"index",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const a=ue(),n=e,u=o;let c=h(!1),S=h(1),d=N({username:"jzm",password:"1234"});h("");function g(){c.value=!1,u("update:modelValue",!1)}function E(){let y=JSON.parse(JSON.stringify(d));y.password=Ne(y.password),a.loginAction(y).then(f=>{f.code==200?(x.success("登录成功"),c.value=!1,u("update:modelValue",!1)):x.error(f.msg)}).catch(f=>{console.log(f)})}function T(){u("update:modelValue",!1)}return Ie(()=>n.modelValue,y=>{c.value=y},{immediate:!0,deep:!0}),(y,f)=>{const w=_("el-input"),U=_("el-form-item"),B=_("el-form"),L=_("el-button"),R=_("el-dialog");return b(),oe(R,{title:"",modelValue:v(c),"onUpdate:modelValue":f[2]||(f[2]=A=>Y(c)?c.value=A:c=A),width:"400px","close-on-click-modal":!1,onClose:T},{footer:r(()=>[l(L,{onClick:g},{default:r(()=>[D("取 消")]),_:1}),l(L,{type:"primary",onClick:E},{default:r(()=>[D("确 定")]),_:1})]),default:r(()=>[s("div",Ye,[s("div",Ge,[s("h2",null,ve(v(S)==1?"登录":"注册"),1),l(B,{model:v(d),"label-width":"60px"},{default:r(()=>[l(U,{label:"用户名"},{default:r(()=>[l(w,{modelValue:v(d).username,"onUpdate:modelValue":f[0]||(f[0]=A=>v(d).username=A),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(U,{label:"密码"},{default:r(()=>[l(w,{modelValue:v(d).password,"onUpdate:modelValue":f[1]||(f[1]=A=>v(d).password=A),placeholder:"请输入密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),We]),_:1},8,["model"])])])]),_:1},8,["modelValue"])}}}),Ze=ce(Xe,[["__scopeId","data-v-8ce87bfa"]]),G=e=>(ae("data-v-32027c9c"),e=e(),ie(),e),et={class:"slide_bar"},tt=G(()=>s("h1",{class:"head_slide"},"Spark4.0",-1)),lt=G(()=>s("hr",null,null,-1)),ot=G(()=>s("ul",{class:"app_box"},[s("li",null,[s("i",{class:"iconfont icon-xinxi",style:{"font-size":"18px"}}),s("p",null,"对话")])],-1)),nt=G(()=>s("i",{class:"iconfont icon-yonghu",style:{"font-size":"24px"}},null,-1)),st=G(()=>s("p",null,"我的",-1)),at=[nt,st],it={class:"slide_chat_info"},ct={class:"cut_version"},rt={class:"add_chat"},ut={class:"chat_box"},dt={class:"chat_search"},pt={key:0},ft={class:"chat_list"},_t=["onClick"],mt={class:"operation_btn"},ht=he({__name:"slideBar",emits:["handleSelect"],setup(e,{emit:o}){const a=o,n=ue(),u=[{label:"Spark4.0 Ultra",value:"4.0Ultra"},{label:"Spark3.5 Max",value:"generalv3.5"},{label:"Spark Pro",value:"generalv3"},{label:"Spark Lite",value:"general"},{label:"Spark Pro-128k",value:"pro-128k"}],c=h("4.0Ultra"),S=N({id:null,userId:n.userInfo.id});console.log(n.userInfo);const d=h(!1),g=N({userId:n.userInfo.id,title:"",type:1});let E=h([]),T=h(""),y=h(-1),f=h(-1),w=h(!1),U=h(!1);N([]);let B=h([]);L(!0);function L(p=!1){Je({userId:S.userId,title:T.value}).then(t=>{t.code==200&&(E.value=t.record.rows,E.value.length>0&&p&&(f.value=0,a("handleSelect",E.value[0])))})}function R(p,t){y.value=t,console.log(p),console.log("编辑")}function A(p){Ue.confirm("确定删除该对话吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ze({id:p.id}).then(t=>{t.code==200?(L(!0),x({type:"success",message:t.msg})):x({type:"error",message:t.msg})})}).catch(()=>{console.log("取消")})}function C(p,t){f.value=t,a("handleSelect",p)}function k(){d.value=!0}function V(){Re(g).then(p=>{p.code==200?(d.value=!1,g.title="",g.type=1,L(!1),x({type:"success",message:p.msg})):x({type:"error",message:p.msg})})}function K(){w.value=!0}function z(){Fe({userId:S.userId,domain:c.value}).then(p=>{console.log(p),p.code==200?x({type:"success",message:p.msg}):x({type:"error",message:p.msg})})}function P(p){Ke({id:p.id,title:p.title}).then(t=>{t.code==200?(x({type:"success",message:t.msg}),y.value=-1):x({type:"error",message:t.msg})})}function O(){}function F(){}function m(){U.value=!1}function $(p){B.value.forEach(t=>{console.log(t.checked)})}return(p,t)=>{const ee=_("el-option"),de=_("el-select"),q=_("el-button"),te=_("el-input"),pe=_("Delete"),W=_("el-icon"),ke=_("Check"),be=_("el-checkbox"),we=_("EditPen"),fe=_("el-form-item"),Ce=_("el-form"),xe=_("el-dialog");return b(),I("div",et,[s("div",{class:"slide_application"},[tt,lt,s("div",null,[ot,s("ul",{class:"user_box"},[s("li",{onClick:K},at)])])]),s("div",it,[s("div",ct,[l(de,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=i=>c.value=i),placeholder:"请选择",onChange:z},{default:r(()=>[(b(),I(Q,null,ne(u,i=>l(ee,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),s("div",rt,[l(q,{icon:"plus",style:{width:"100%"},plain:"",onClick:k},{default:r(()=>[D("新建对话")]),_:1})]),s("div",ut,[s("div",dt,[v(U)?(b(),I("div",pt,[l(q,{onClick:O},{default:r(()=>[D("全选")]),_:1}),l(q,{onClick:F},{default:r(()=>[D("删除")]),_:1}),l(q,{onClick:m},{default:r(()=>[D("退出")]),_:1})])):(b(),I(Q,{key:1},[l(te,{modelValue:v(T),"onUpdate:modelValue":t[1]||(t[1]=i=>Y(T)?T.value=i:T=i),style:{width:"180px"},placeholder:"搜索历史记录","suffix-icon":"Search",onKeyup:t[2]||(t[2]=se(i=>L(),["enter"]))},null,8,["modelValue"]),l(W,{class:"del_btn",onClick:t[3]||(t[3]=i=>Y(U)?U.value=!0:U=!0)},{default:r(()=>[l(pe)]),_:1})],64))]),s("ul",ft,[(b(!0),I(Q,null,ne(v(E),(i,H)=>(b(),I("li",{key:H,class:X({actived:v(f)===H})},[v(y)===H?(b(),oe(te,{key:0,modelValue:i.title,"onUpdate:modelValue":M=>i.title=M,placeholder:"请输入标题",onBlur:M=>P(i)},{append:r(()=>[l(W,{onClick:M=>P(i)},{default:r(()=>[l(ke)]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","onBlur"])):(b(),I(Q,{key:1},[Z((b(),oe(be,{key:i.id,value:i.id,ref_for:!0,ref_key:"checkbox",ref:B,onChange:$,"true-value":"1","false-value":"0"},null,8,["value"])),[[ge,v(U)]]),s("p",{class:"ellipsis",onClick:M=>C(i,H)},ve(i.title),9,_t),s("div",mt,[l(W,{onClick:M=>R(i,H)},{default:r(()=>[l(we)]),_:2},1032,["onClick"]),l(W,{onClick:M=>A(i)},{default:r(()=>[l(pe)]),_:2},1032,["onClick"])])],64))],2))),128))])])]),l(xe,{title:"新建对话",modelValue:d.value,"onUpdate:modelValue":t[8]||(t[8]=i=>d.value=i),width:"400","close-on-click-modal":!1,"align-center":""},{footer:r(()=>[s("div",null,[l(q,{onClick:t[7]||(t[7]=i=>d.value=!1)},{default:r(()=>[D("取 消")]),_:1}),l(q,{type:"primary",onClick:V},{default:r(()=>[D("确 定")]),_:1})])]),default:r(()=>[l(Ce,{model:g,"label-width":"70px",onSubmit:t[6]||(t[6]=Te(()=>{},["prevent"]))},{default:r(()=>[l(fe,{label:"对话标题"},{default:r(()=>[l(te,{modelValue:g.title,"onUpdate:modelValue":t[4]||(t[4]=i=>g.title=i),type:"text",placeholder:"请输入对话",onKeyup:se(V,["enter"])},null,8,["modelValue"])]),_:1}),l(fe,{label:"类型"},{default:r(()=>[l(de,{modelValue:g.type,"onUpdate:modelValue":t[5]||(t[5]=i=>g.type=i),placeholder:"请选择类型"},{default:r(()=>[l(ee,{label:"文本",value:1}),l(ee,{label:"图片",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Ze,{modelValue:v(w),"onUpdate:modelValue":t[9]||(t[9]=i=>Y(w)?w.value=i:w=i)},null,8,["modelValue"])])}}}),vt=ce(ht,[["__scopeId","data-v-32027c9c"]]),gt=e=>(ae("data-v-4e36c209"),e=e(),ie(),e),yt={class:"common-layout"},kt={class:"ai_chat_main"},bt={class:"chat_list"},wt={class:"chat_img"},Ct=gt(()=>s("i",{class:"iconfont icon-xia",style:{"font-size":"20px"}},null,-1)),xt=[Ct],St={__name:"index",setup(e){console.log("production");const o=ue();let a=h(""),n=h(""),u,c=h(!1),S=h(!1),d=N([]),g=h(0),E=h(!1),T=h(-1),y=h(!1);const f=N({id:null,userId:o.userInfo.id,type:1}),w=N({pageSize:10,pageNum:1});Be(()=>{u=document.querySelector(".el-main"),u.addEventListener("scroll",C=>{g.value=C.target.scrollTop,g.value||(R(),C.target.scrollTop=20)}),B()}),E=Ae(()=>n.value?n.value.scrollHeight-n.value.clientHeight-g.value>300:!1),le(()=>{}),Ee(()=>{u.removeEventListener("scroll",C=>{g.value=C.target.scrollTop})});function U(C){let k=a.value;if(!C.shiftKey){if(y.value)return x.error("请等待回复");if(["",null,void 0].includes(a.value.trim()))return x.error("请输入内容");y.value=!0,d.push({role:"user",content:a.value.replace(/\n/g,"<br>")}),d.push({role:"assistant",content:""}),T.value=d.length-1,le(()=>{B()}),c.value=!0,a.value="",fetch("http://1.94.146.141:8848/ws/getAccessToken",{method:"post",headers:{"Content-Type":"application/json",NoEncrypt:!0},body:JSON.stringify({text:k,userId:f.userId,id:f.id,type:f.type})}).then(V=>{if(V.status==500)return c.value=!1,y.value=!1,d.pop(),x.error(V.statusText),!1;const K=new TextDecoder("utf-8");let z=[];c.value=!1;const P=V.body.getReader();function O(){P.read().then(function({done:m,value:$}){if(m)return z;const p=K.decode($,{stream:!1});try{let t=JSON.parse(p.substring(p.indexOf("{")));B(),d.at(-1).content+=t.content,t.type==2&&(y.value=!1),O()}catch{y.value=!1}})}return O()}).then(V=>{T.value=""}).catch(V=>{y.value=!1,d.pop()})}}function B(){u.scrollTop=u.scrollHeight}function L(){x({message:"复制成功",type:"success"})}function R(){S.value=!0,w.pageNum++;let C={...f,...w};me(C).then(k=>{k.record.rows.length===0&&(w.pageNum-=1),S.value=!1,d.unshift(...k.record.rows)})}function A(C){f.id=C.id,f.type=C.type,w.pageNum=1,S.value=!0;let k={...f,...w};me(k).then(V=>{S.value=!1,d.length=0,d.push(...V.record.rows),le(()=>{d.length?B():u.scrollTop=1})})}return(C,k)=>{const V=_("el-aside"),K=_("v-md-preview"),z=_("el-input"),P=_("el-footer"),O=_("el-container"),F=Le("loading");return b(),I("div",yt,[l(O,null,{default:r(()=>[l(V,{width:"300px"},{default:r(()=>[l(vt,{onHandleSelect:A})]),_:1}),l(O,{class:"main_container"},{default:r(()=>[s("div",{ref_key:"chatRef",ref:n,class:"el-main"},[Z((b(),I("div",kt,[s("ul",bt,[(b(!0),I(Q,null,ne(v(d),(m,$)=>(b(),I("li",{class:"chat_list_item",key:$},[s("div",{class:X(["chat_item_content",{user_style:m.role=="user"}])},[s("div",wt,[s("i",{class:X(["iconfont",{"icon-Ai":m.role=="assistant","icon-yonghu":m.role=="user"}]),style:{"font-size":"35px"}},null,2)]),Z((b(),I("div",{class:X(["chat_info",{mr12:m.role=="user",ml12:m.role=="assistant"}])},[l(K,{text:m.content,onCopyCodeSuccess:L},null,8,["text"])],2)),[[F,!m.content&&$==v(T)]])],2)]))),128))]),Z(s("div",{class:"go_to_bottom",onClick:k[0]||(k[0]=m=>B())},xt,512),[[ge,v(E)]])])),[[F,v(S)]])],512),l(P,null,{default:r(()=>[l(z,{type:"textarea",modelValue:v(a),"onUpdate:modelValue":k[1]||(k[1]=m=>Y(a)?a.value=m:a=m),placeholder:"请输入聊天内容（shift + enter）换行",rows:4,class:"text_area",resize:"none",onKeypress:k[2]||(k[2]=m=>{m.keyCode==13&&!m.shiftKey&&m.preventDefault()}),onKeyup:k[3]||(k[3]=se(m=>U(m),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},Ut=ce(St,[["__scopeId","data-v-4e36c209"]]);export{Ut as default};
